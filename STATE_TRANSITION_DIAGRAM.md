# ğŸ“Š é£²æ–™åº«å­˜ç‹€æ…‹è½‰æ›åœ–ï¼ˆState Transition Diagramï¼‰

## ğŸ¯ ç‹€æ…‹å®šç¾©

| ç‹€æ…‹ | æ¢ä»¶ | èªªæ˜ |
|------|------|------|
| **åœ¨åº« (InStock)** | `quantity > 0 && expiryDate >= today` | æœ‰åº«å­˜ä¸”æœªéæœŸ |
| **å³å°‡éæœŸ (ExpiringSoon)** | `quantity > 0 && expiryDate <= today + 7` | 7 å¤©å…§æœƒéæœŸ |
| **å·²éæœŸ (Expired)** | `quantity > 0 && expiryDate < today` | å·²è¶…éæœ‰æ•ˆæœŸé™ |
| **å·²å‡ºåº« (OutOfStock)** | `quantity = 0` | åº«å­˜ç‚º 0 |

---

## ğŸ“ ç‹€æ…‹è½‰æ›åœ–ï¼ˆASCII Artï¼‰

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   å…¥åº«æ“ä½œ      â”‚
                    â”‚  (Stock In)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     åœ¨åº«         â”‚
                    â”‚   (InStock)     â”‚
                    â”‚ quantity > 0   â”‚
                    â”‚ expiryDate >=   â”‚
                    â”‚    today        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                    â”‚
        â”‚                    â”‚                    â”‚
        â†“                    â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å³å°‡éæœŸ     â”‚    â”‚   å‡ºåº«æ“ä½œ    â”‚    â”‚   æ™‚é–“æ¨ç§»    â”‚
â”‚(ExpiringSoon)â”‚    â”‚  (Stock Out) â”‚    â”‚ (Time Pass) â”‚
â”‚ quantity > 0 â”‚    â”‚              â”‚    â”‚              â”‚
â”‚ expiryDate   â”‚    â”‚              â”‚    â”‚              â”‚
â”‚ <= today+7   â”‚    â”‚              â”‚    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚              â”‚    â”‚              â”‚
        â”‚           â”‚              â”‚    â”‚              â”‚
        â”‚           â†“              â”‚    â”‚              â”‚
        â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚              â”‚
        â”‚    â”‚   å·²å‡ºåº«      â”‚     â”‚    â”‚              â”‚
        â”‚    â”‚ (OutOfStock) â”‚     â”‚    â”‚              â”‚
        â”‚    â”‚ quantity = 0 â”‚     â”‚    â”‚              â”‚
        â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚              â”‚
        â”‚                          â”‚    â”‚              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”˜              â”‚
                                   â”‚                    â”‚
                                   â†“                    â†“
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   å·²éæœŸ     â”‚    â”‚   å·²éæœŸ     â”‚
                            â”‚  (Expired)   â”‚    â”‚  (Expired)   â”‚
                            â”‚ quantity > 0 â”‚    â”‚ quantity > 0 â”‚
                            â”‚ expiryDate   â”‚    â”‚ expiryDate   â”‚
                            â”‚  < today     â”‚    â”‚  < today     â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ ç‹€æ…‹è½‰æ›è¡¨

| ç•¶å‰ç‹€æ…‹ | äº‹ä»¶/æ“ä½œ  | ä¸‹ä¸€ç‹€æ…‹ | æ˜¯å¦åˆæ³• | æ¸¬è©¦æ¡ˆä¾‹ |
|---------|----------|---------|---------|---------|
| **åœ¨åº«** | å‡ºåº«æ“ä½œ  | å·²å‡ºåº«   | âœ… åˆæ³•  | `testStateTransition_InStock_To_OutOfStock` |
| **åœ¨åº«** | æ™‚é–“æ¨ç§»ï¼ˆ7 å¤©å…§éæœŸï¼‰ | å³å°‡éæœŸ | âœ… åˆæ³• | `testStateTransition_InStock_To_ExpiringSoon` |
| **åœ¨åº«** | æ™‚é–“æ¨ç§»ï¼ˆå·²éæœŸï¼‰ | å·²éæœŸ | âœ… åˆæ³• | `testStateTransition_InStock_To_Expired` |
| **å³å°‡éæœŸ** | å‡ºåº«æ“ä½œ | å·²å‡ºåº« | âœ… åˆæ³• | `testStateTransition_ExpiringSoon_To_OutOfStock` |
| **å³å°‡éæœŸ** | æ™‚é–“æ¨ç§»ï¼ˆå·²éæœŸï¼‰ | å·²éæœŸ | âœ… åˆæ³• | `testStateTransition_ExpiringSoon_To_Expired` |
| **å·²éæœŸ** | å‡ºåº«æ“ä½œ | å·²å‡ºåº« | âš ï¸ éœ€ç¢ºèªæ¥­å‹™è¦å‰‡ | å¯æ¸¬è©¦ |
| **å·²å‡ºåº«** | å…¥åº«æ“ä½œï¼ˆæ–°å•†å“ï¼‰ | åœ¨åº« | âœ… åˆæ³• | `testStateTransition_StockIn_To_InStock` |
| **åœ¨åº«** | ç›´æ¥è®Šæˆå·²å‡ºåº«ï¼ˆç„¡å‡ºåº«æ“ä½œï¼‰ | å·²å‡ºåº« | âŒ éæ³• | ç³»çµ±æ‡‰é˜»æ­¢ |

---

## ğŸ”„ ç‹€æ…‹è½‰æ›è©³ç´°èªªæ˜

### è½‰æ› 1ï¼šå…¥åº« â†’ åœ¨åº«

**è§¸ç™¼äº‹ä»¶**ï¼šåŸ·è¡Œ `stockIn()` æ“ä½œ

**å‰ç½®æ¢ä»¶**ï¼š
- ç„¡ï¼ˆå¯ä»¥å¾ä»»ä½•ç‹€æ…‹æˆ–åˆå§‹ç‹€æ…‹é–‹å§‹ï¼‰

**å¾Œç½®æ¢ä»¶**ï¼š
- `quantity > 0`
- `expiryDate >= today`
- ç‹€æ…‹è®Šç‚ºã€Œåœ¨åº«ã€

**æ¸¬è©¦æ¡ˆä¾‹**ï¼š
```java
@Test
void testStateTransition_StockIn_To_InStock() {
    // åŸ·è¡Œå…¥åº«
    // é©—è­‰ç‹€æ…‹ï¼šåœ¨åº«
}
```

---

### è½‰æ› 2ï¼šåœ¨åº« â†’ å‡ºåº« â†’ å·²å‡ºåº«

**è§¸ç™¼äº‹ä»¶**ï¼šåŸ·è¡Œ `stockOut()` æ“ä½œ

**å‰ç½®æ¢ä»¶**ï¼š
- ç•¶å‰ç‹€æ…‹ï¼šåœ¨åº«
- `quantity > 0`
- `expiryDate >= today`

**å¾Œç½®æ¢ä»¶**ï¼š
- å¦‚æœ `å‡ºåº«æ•¸é‡ == åº«å­˜`ï¼šç‹€æ…‹è®Šç‚ºã€Œå·²å‡ºåº«ã€ï¼ˆ`quantity = 0`ï¼‰
- å¦‚æœ `å‡ºåº«æ•¸é‡ < åº«å­˜`ï¼šç‹€æ…‹ä»ç‚ºã€Œåœ¨åº«ã€ï¼ˆ`quantity > 0`ï¼‰

**æ¸¬è©¦æ¡ˆä¾‹**ï¼š
```java
@Test
void testStateTransition_InStock_To_OutOfStock() {
    // 1. åœ¨åº«
    // 2. å‡ºåº«å…¨éƒ¨
    // 3. é©—è­‰ï¼šå·²å‡ºåº«
}
```

---

### è½‰æ› 3ï¼šåœ¨åº« â†’ å³å°‡éæœŸ

**è§¸ç™¼äº‹ä»¶**ï¼šæ™‚é–“æ¨ç§»ï¼ˆç³»çµ±è‡ªå‹•æª¢æŸ¥ï¼‰

**å‰ç½®æ¢ä»¶**ï¼š
- ç•¶å‰ç‹€æ…‹ï¼šåœ¨åº«
- `quantity > 0`
- `expiryDate <= today + 7`ï¼ˆ7 å¤©å…§æœƒéæœŸï¼‰

**å¾Œç½®æ¢ä»¶**ï¼š
- ç‹€æ…‹è®Šç‚ºã€Œå³å°‡éæœŸã€
- `expiringSoon = true`

**æ¸¬è©¦æ¡ˆä¾‹**ï¼š
```java
@Test
void testStateTransition_InStock_To_ExpiringSoon() {
    // å…¥åº« 5 å¤©å¾ŒéæœŸçš„å•†å“
    // é©—è­‰ï¼šå³å°‡éæœŸ
}
```

---

### è½‰æ› 4ï¼šåœ¨åº« â†’ å·²éæœŸ

**è§¸ç™¼äº‹ä»¶**ï¼šæ™‚é–“æ¨ç§»ï¼ˆç³»çµ±è‡ªå‹•æª¢æŸ¥ï¼‰

**å‰ç½®æ¢ä»¶**ï¼š
- ç•¶å‰ç‹€æ…‹ï¼šåœ¨åº«
- `quantity > 0`
- `expiryDate < today`ï¼ˆå·²éæœŸï¼‰

**å¾Œç½®æ¢ä»¶**ï¼š
- ç‹€æ…‹è®Šç‚ºã€Œå·²éæœŸã€
- `expired = true`

**æ¸¬è©¦æ¡ˆä¾‹**ï¼š
```java
@Test
void testStateTransition_InStock_To_Expired() {
    // å…¥åº«å·²éæœŸçš„å•†å“
    // é©—è­‰ï¼šå·²éæœŸ
}
```

---

### è½‰æ› 5ï¼šå³å°‡éæœŸ â†’ å·²éæœŸ

**è§¸ç™¼äº‹ä»¶**ï¼šæ™‚é–“æ¨ç§»ï¼ˆç³»çµ±è‡ªå‹•æª¢æŸ¥ï¼‰

**å‰ç½®æ¢ä»¶**ï¼š
- ç•¶å‰ç‹€æ…‹ï¼šå³å°‡éæœŸ
- `quantity > 0`
- `expiryDate < today`ï¼ˆå·²éæœŸï¼‰

**å¾Œç½®æ¢ä»¶**ï¼š
- ç‹€æ…‹è®Šç‚ºã€Œå·²éæœŸã€
- `expired = true`
- `expiringSoon = false`

**æ¸¬è©¦æ¡ˆä¾‹**ï¼š
```java
@Test
void testStateTransition_ExpiringSoon_To_Expired() {
    // æ™‚é–“æ¨ç§»æ¨¡æ“¬
    // é©—è­‰ï¼šå·²éæœŸ
}
```

---

## ğŸš« éæ³•ç‹€æ…‹è½‰æ›

ä»¥ä¸‹è½‰æ›æ‡‰è©²è¢«ç³»çµ±é˜»æ­¢ï¼š

1. **åœ¨åº« â†’ å·²å‡ºåº«ï¼ˆç„¡å‡ºåº«æ“ä½œï¼‰**
   - ç³»çµ±æ‡‰å¼·åˆ¶åŸ·è¡Œå‡ºåº«æµç¨‹
   - ä¸èƒ½ç›´æ¥ä¿®æ”¹è³‡æ–™åº«å°‡åº«å­˜è¨­ç‚º 0

2. **å·²å‡ºåº« â†’ åœ¨åº«ï¼ˆç„¡å…¥åº«æ“ä½œï¼‰**
   - ç³»çµ±æ‡‰å¼·åˆ¶åŸ·è¡Œå…¥åº«æµç¨‹
   - ä¸èƒ½ç›´æ¥ä¿®æ”¹è³‡æ–™åº«å¢åŠ åº«å­˜

3. **å·²éæœŸ â†’ åœ¨åº«ï¼ˆç„¡æ“ä½œï¼‰**
   - å·²éæœŸçš„å•†å“ä¸èƒ½è‡ªå‹•è®Šå›åœ¨åº«
   - éœ€è¦é‡æ–°å…¥åº«æ–°å•†å“

---

## ğŸ§ª æ¸¬è©¦è¦†è“‹

### åˆæ³•è½‰æ›æ¸¬è©¦

| è½‰æ› | æ¸¬è©¦æª”æ¡ˆ | æ¸¬è©¦æ–¹æ³• |
|------|---------|---------|
| å…¥åº« â†’ åœ¨åº« | `BeverageStateTransitionTest` | `testStateTransition_StockIn_To_InStock` |
| åœ¨åº« â†’ å‡ºåº« â†’ å·²å‡ºåº« | `BeverageStateTransitionTest` | `testStateTransition_InStock_To_OutOfStock` |
| åœ¨åº« â†’ å³å°‡éæœŸ | `BeverageStateTransitionTest` | `testStateTransition_InStock_To_ExpiringSoon` |
| åœ¨åº« â†’ å·²éæœŸ | `BeverageStateTransitionTest` | `testStateTransition_InStock_To_Expired` |
| éƒ¨åˆ†å‡ºåº«ï¼ˆä»åœ¨åº«ï¼‰ | `BeverageStateTransitionTest` | `testStateTransition_PartialStockOut_RemainInStock` |

---

## ğŸ’¡ é¢è©¦æ‡‰ç”¨

### å¦‚ä½•å‘é¢è©¦å®˜å±•ç¤ºç‹€æ…‹è½‰æ›åœ–

1. **åœ¨ç™½æ¿ä¸Šç•«å‡ºç‹€æ…‹è½‰æ›åœ–**
   - å±•ç¤º 4 å€‹ç‹€æ…‹
   - å±•ç¤ºæ‰€æœ‰åˆæ³•è½‰æ›è·¯å¾‘
   - èªªæ˜éæ³•è½‰æ›çš„é˜²è­·æ©Ÿåˆ¶

2. **èªªæ˜æ¸¬è©¦ç­–ç•¥**
   - æ¸¬è©¦æ‰€æœ‰åˆæ³•è½‰æ›
   - é©—è­‰éæ³•è½‰æ›è¢«é˜»æ­¢
   - ä½¿ç”¨ç‹€æ…‹è½‰æ›æ¸¬è©¦æŠ€è¡“

3. **å¼·èª¿å¯¦å‹™ç¶“é©—**
   - åœ¨ SmartWarehouse å°ˆæ¡ˆä¸­å¯¦ä½œ
   - ä½¿ç”¨ JUnit è‡ªå‹•åŒ–æ¸¬è©¦
   - æ•´åˆåˆ° CI/CD æµç¨‹

---

## ğŸ“š ç›¸é—œæ–‡ä»¶

- [V æ¨¡å‹å®Œæ•´æ‡‰ç”¨](./V_MODEL_APPLICATION.md)
- [ISTQB æ¸¬è©¦ç†è«–](./ISTQB_TEST_THEORY.md)
- [ç‹€æ…‹è½‰æ›æ¸¬è©¦å¯¦ä½œ](../backend/src/test/java/com/beveragewarehouse/service/BeverageStateTransitionTest.java)

---

**é€™å€‹ç‹€æ…‹è½‰æ›åœ–å®Œç¾å±•ç¤ºäº† ISTQB ç‹€æ…‹è½‰æ›æ¸¬è©¦ç†è«–çš„å¯¦éš›æ‡‰ç”¨ï¼** ğŸ‰

