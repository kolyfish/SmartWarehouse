# 🏭 業界過期商品處理標準流程

## 📋 業界實際做法

在真實的倉庫管理系統（WMS）中，過期商品的處理通常遵循以下標準流程：

### 1. **隔離區管理（Quarantine）**
- 過期商品自動移到隔離區
- 不能正常出庫，需要特殊權限才能操作
- 防止過期商品誤出庫給客戶

### 2. **狀態管理（Status Management）**
- **NORMAL**：正常商品，可以正常出庫
- **QUARANTINED**：隔離中，已過期但尚未處理
- **DISPOSED**：已報廢，已從庫存中移除

### 3. **報廢流程（Disposal Process）**
- 需要審批流程（通常需要主管核准）
- 記錄報廢原因、數量、時間
- 產生報廢單據

### 4. **自動鎖定機制**
- 系統自動檢測過期商品
- 自動將狀態改為 QUARANTINED
- 禁止正常出庫操作

### 5. **報表與提醒**
- 定期產生過期商品報表
- 即將過期商品提醒（7 天內）
- 報廢統計報表

---

## 🎯 SmartWarehouse 實作方案

### 方案 1：狀態欄位 + 隔離區（推薦）

**優點**：
- 符合業界標準
- 資料追蹤完整
- 可以統計報廢數量

**實作**：
1. 在 `Beverage` 模型中加入 `status` 欄位
2. 建立隔離區查詢方法
3. 建立報廢 API
4. 更新出庫邏輯，只允許 NORMAL 狀態出庫

### 方案 2：軟刪除 + 標記

**優點**：
- 實作簡單
- 不改變現有結構

**缺點**：
- 無法追蹤報廢歷史
- 不符合業界標準

---

## 📊 狀態轉換圖（業界標準）

```
[入庫] → [NORMAL] → [出庫] → [已出庫]
           │
           ├─→ [時間推移] → [QUARANTINED] → [報廢審批] → [DISPOSED]
           │
           └─→ [即將過期提醒]
```

---

## 🔄 處理流程

### 流程 1：自動隔離過期商品

```
1. 系統定時檢查（每日凌晨）
2. 找出所有過期商品
3. 自動將狀態改為 QUARANTINED
4. 發送通知給管理員
```

### 流程 2：報廢審批

```
1. 管理員查看隔離區商品
2. 選擇要報廢的商品
3. 填寫報廢原因
4. 提交審批（或直接報廢）
5. 狀態改為 DISPOSED
6. 從庫存中移除（或保留記錄）
```

### 流程 3：出庫檢查

```
1. 使用者請求出庫
2. 系統檢查商品狀態
3. 如果是 QUARANTINED 或 DISPOSED，拒絕出庫
4. 只有 NORMAL 狀態才能出庫
```

---

## 💡 業界最佳實踐

### 1. **FIFO + 過期檢查**
- 出庫時優先出庫最早過期的（FIFO）
- 但只出庫未過期的商品
- 過期商品自動隔離

### 2. **批次管理**
- 每個入庫批次有獨立的過期日期
- 可以追蹤哪個批次過期
- 方便批次報廢

### 3. **審批流程**
- 小額報廢：直接報廢
- 大額報廢：需要主管審批
- 記錄審批人、時間、原因

### 4. **報表統計**
- 過期商品數量統計
- 報廢金額統計
- 過期趨勢分析

---

## 🚀 實作建議

建議採用**方案 1：狀態欄位 + 隔離區**，因為：

1. ✅ **符合業界標準**：真實 WMS 系統都這樣做
2. ✅ **資料完整性**：可以追蹤報廢歷史
3. ✅ **面試加分**：展示對業界標準的理解
4. ✅ **擴展性好**：未來可以加入審批流程

---

## 📚 相關文件

- [狀態轉換圖](./STATE_TRANSITION_DIAGRAM.md)
- [V 模型應用](./V_MODEL_APPLICATION.md)

